@(message: String)

@main("Put your voice") {

  <div id="container">
    <div id="content">
      <h1>hello</h1>
      <audio class="audio">your browser can't use audio tag</audio>
      <div class="record">
        <button id="record_start" class="recorder">Start to Record</button>
        <button id="record_stop" class="recorder">Stop to Record</button>
      </div>
      <div class="play">
        <button id="player" class="player">Play</button>
      </div>
    </div>
  </div>
  <script src='@routes.Assets.at("javascripts/audio-helper.js")' type="text/javascript"></script>
  <script type="text/javascript">
    var observerOfRecorder = null;

    /*
     * 
     */
    var onClickRecordStart = function(e) {
      window.audioBufferArray = [];

      navigator.getUserMedia(
        { video: false, audio: true },
        function(stream) {
          var mediaStreamSource = window.audioContext.createMediaStreamSource(stream);
          var scriptProcessor = window.audioContext.createScriptProcessor(BUFFERSIZE, 1, 1);

          mediaStreamSource.connect(scriptProcessor);
          scriptProcessor.connect(window.audioContext.destination);

          // record
          scriptProcessor.onaudioprocess = window.onAudioProcess;

          // stop after clicked stop button
          window.observerOfRecorder = new Object();
          var timer = window.setInterval(function() {
            console.log('interval');
            if (window.observerOfRecorder == null) {
              stream.stop();
              window.clearInterval(timer);
            }
          }, 1000);
        },
        function (error) {
          console.log(error.name ? error.name : error);
        }
      );
    };

    var onClickRecordStop = function(e) {
      window.observerOfRecorder = null;
    };

    /*
     * 
     */
    var onClickPlayer = function(e) {
      var src = window.audioContext.createBufferSource();
      src.buffer = getAudioBuffer(window.audioBufferArray, BUFFERSIZE);
      src.connect(audioContext.destination);
      src.start();
    };

    $('#record_start').on('click', onClickRecordStart);
    $('#record_stop').on('click', onClickRecordStop);
    $('#player').on('click', onClickPlayer);
  </script>
}
